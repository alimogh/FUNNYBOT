Funnybot v 1.0
==============

Telegram RUS
<https://t.me/joinchat/F16v6U3VVb6oCc10di4DVQ>


Требования
----------

* PHP
* MySQL
* PHP-cURL (В базовом комплекте php не поставляется, устанавливается отдельно)

Назначение программы
--------------------

Торговля по сигналам на криптовалютной бирже binance в автоматическом режиме.

Логика программы
----------------

1. Получение сигналов об открытии позиций
2. Сравнение сигналов с данными открытых позиций в хранилище
* Если такой позиции не открыто - далее п.3. Если позиция открыта - п.7.
3. Получение данных о котировках
4. Получение данных о отправленных ордерах
* Если ордера не исполнены - отменяем ордера. Далее п.5.
* Если ордера отсутствуют, далее п.5
* Если ордера исполнены - записывание данных об открытии позиции в хранилище, удаление данных об отправленных ордерах из хранилища, далее п.7.
5. Сравнение данных о балансах необходимых для открытия позиции
* Если средств хватает - далее п.6. Иначе п.7.
6. Отправка ордера на покупку, запись в хранилище данных об отправленных ордерах
7. Сравнение котировок и вычисление профита по открытым позициям
* Если профит растет, обновляем данные по открытой позиции в хранилище
* Если профит падает, проверяем настройки выхода
* Если условие выхода выполнено, закрываем позицию, отправляем ордер продажи, удаляем запись по открытой позиции из хранилища, записываем в хранилище данные по получению профита.
8. Далее п.1

Состав программы
----------------
### Основной код
#### Обработка:
* получение данных о балансах пользователя биржи через API
* получение данных котировках биржи через API
* получение данных о выполненных ордерах пользователя биржи через API
* получение данных о неисполненных ордерах пользователя биржи через API
* получение данных о сигналах через API
* вычисление данных об открытых позициях
* сравнение правил биржи и настроек пользователя
* вычисление контрольных правил для открытия/закрытия позиций
* отправка ордеров через API
#### Хранение:
* хранение настроек биржи в MySQL
* хранение настроек пользователя в MySQL
* хранение данных об открытых ордерах в MySQL
* хранение данных об открытых ордерах в MySQL
### Вспомогательный код
#### Обработка:
* получение данных о настройках пользователя из MySQL
* запись данных о настройках пользователя в MySQL
* получение данных настройках биржи через API

Описание функций
----------------
1. Хранение настроек пользователя
**MySQL**

#### Таблица `settings`
Поле       | Тип            | Обязательный | Описание
-----------|----------------|--------------|------------------------------------------------------
id         | Целое число    | Да           | Номер комплекта настроек
api_key    | Строка         | Да           | API ключ для торговли
api_secret | Строка         | Да           | API секретный ключ для торговли
open_url   | Строка         | Да           | Ссылка для получения сигналов открытия позиции
amount     | Число с точкой | Да           | Размер позиции для открытия позиции. Эквивалентное в USDT
fee        | Число с точкой | Да           | Размер комиссии биржи за совершение сделки
delta      | Число с точкой | Да           | Размер погрешности, необходимый для вычисления соответствия ордера 
pause      | Целое число    | Да           | Время паузы в секундах, до начала действия проверок выхода.
close_url  | Строка         | Нет          | Ссылка для получения сигналов закрытия позиции
close_time | Целое число    | Нет          | Время в секундах, после которого позиция закрывается
close_lose | Число с точкой | Нет          | Значение падения профита от максимального, ниже которого позиция закрывается
close_exit | Число с точкой | Да           | Значение падения цены котировки в процентах, ниже которого позиция закрывается

2. Хранение ордеров
**MySQL**

#### Таблица `orders`
Поле       | Тип            | Описание
-----------|----------------|------------------------------------------------------
id         | Целое число    | Номер по порядку
symbol     | Строка         | Обозначение котировки (BTCUSDT)
order_id   | Целое число    | Номер ордера на бирже
price      | Число с точкой | Цена
qty        | Число с точкой | Количество
side       | Строка         | Направление сделки (BUY или SELL)
open_time  | Целое число    | Время отправки ордера в формате timestamp
position   | Целое число    | При открытии позиции = 0. При закрытии позиции = номер позиции, которую закрывает ордер
close_res  | Строка         | Причина закрытия (URL, TIME, LOSE, EXIT)
set_id     | Целое число    | Номер настройки пользователя по которой работает торговая программа

3. Хранение открытых позиций
**MySQL**

#### Таблица `positions`
Поле       | Тип            | Описание
-----------|----------------|------------------------------------------------------
id         | Целое число    | Номер по порядку
symbol     | Строка         | Обозначение котировки (BTCUSDT)
price      | Число с точкой | Цена открытия позиции
qty        | Число с точкой | Количество
open_time  | Целое число    | Время открытия позиции в формате timestamp
max_price  | Число с точкой | Максимальная цена. Значение обновляется в таблице если текущее значение больше предыдущего.
set_id     | Целое число    | Номер настройки пользователя по которой работает торговая программа

4. Хранение закрытых позиций
**MySQL**

#### Таблица `history`
Поле       | Тип            | Описание
-----------|----------------|------------------------------------------------------
id         | Целое число    | Номер по порядку
symbol     | Строка         | Обозначение котировки (BTCUSDT)
open_price | Число с точкой | Цена открытия позиции
close_price| Число с точкой | Цена закрытия позиции
qty        | Число с точкой | Количество
open_time  | Целое число    | Время открытия позиции в формате timestamp
close_time | Целое число    | Время закрытия позиции в формате timestamp
close_res  | Строка         | Причина закрытия позиции (URL, TIME, LOSE, EXIT)
set_id     | Целое число    | Номер настройки пользователя по которой торговая программа отработала позицию

5. Хранение параметров торгуемых пар биржи
**MySQL**

#### Таблица `pairs`
Поле       | Тип            | Описание
-----------|----------------|------------------------------------------------------
id         | Целое число    | Номер по порядку
symbol     | Строка         | Обозначение торгуемой пары
base       | Строка         | Основная валюта
quote      | Строка         | Котируемая валюта
min_price  | Число с точкой | Минимальная цена
max_price  | Число с точкой | Максимальная цена
step_price | Число с точкой | Шаг цены
min_qty    | Число с точкой | Минимальный объем
max_qty    | Число с точкой | Максимальный объем
step_qty   | Число с точкой | Шаг объема

